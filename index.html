<!DOCTYPE html>
<html>
<head>
	<title>CORI Preparedness Score Demo</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">


	<!-- Include Leaflet -->
	<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
	<link href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" rel="stylesheet">
	<!-- Include CARTO.js -->
	<script src="https://libs.cartocdn.com/carto.js/v4.2.0/carto.min.js"></script>
	<link href="https://carto.com/developers/carto-js/examples/maps/public/style.css" rel="stylesheet">

	<!--Other libraries-->
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

	<!--Internal CSS-->
	<link rel="stylesheet" type="text/css" href="popup.css">

</head>
<body>

<div id="map">

</div>

<script src="popupHTMLTemplates.js"></script>
<script src="DataFetcher.js"></script>
<script src="PopupGenerator.js"></script>
<script src="Map.js"></script>

<script>

	const CARTO_LAYERS = {
		countyPreparedness: 'county_preparedness_score_v0_5',
		closedHospitalDriveTimeRadius: 'cori_master_closed_hospitals_dataset_drive_time'
	}

	const cartoClientCredentials = {
		apiKey: 'default_public',
		username: 'ruralinnovation-admin',
		CARTO_SERVER: "https://ruralinnovation-admin.carto.com",
	}

	const layers = {
		[CARTO_LAYERS.countyPreparedness]: {
			dataset: CARTO_LAYERS.countyPreparedness,
			popupFieldInfo: [
				// Search and replace these fields in the popup template (if they exist):
				{field: 'cartodb_id'},
				{field: 'name'},
				{field: 'st_stusps'},
				{field: 'prep_score'},
				{field: 'prep_level'},
				// Iterate over these fields and inject each as a section into the popup template:
				{field: 'pc_score', fieldTitle: 'Physical Capacity'},
				{field: 'hr_score', fieldTitle: 'Human Resources'},
				{field: 'dem_score', fieldTitle: 'Demographic'},
				{field: 'se_score', fieldTitle: 'Socioeconimic'},
				{field: 'covid_score', fieldTitle: 'COVID-19'},
			],
			style: `
				#layer {
				  polygon-fill: ramp(
					[prep_score],
					(
					  #dc0302,
					  #DD6F4C,
					  #1FADB6,
					  #76D282,
					  #77ff02
					),
					equal
				  );
				  polygon-opacity: 0.4;
				}
			`
		},
		[CARTO_LAYERS.closedHospitalDriveTimeRadius]: {
			dataset: CARTO_LAYERS.closedHospitalDriveTimeRadius,
			popupFieldInfo: [
				{field: 'cartodb_id'},
				// Search and replace these fields in the popup template (if they exist):
				{field: 'name'},
				{field: 'state'},
				// Iterate over these fields and inject each as a section into the popup template:
				{field: 'type', fieldTitle: 'Hospital Type'},
				{field: 'name', fieldTitle: 'Hospital Name'},
				{field: 'city', fieldTitle: 'City'},
			],
			style: `
				#layer {
				  polygon-fill: #ffffff;
				  polygon-opacity: 0.8;
				}
				#layer::outline {
				  line-width: 1;
				  line-color: #000000;
				  line-opacity: 0.09;
				}
			`
		}
	}


	const map = new Map('map', cartoClientCredentials, layers)

	const sampleCounties = [
		{"cartodb_id":1,"name":"Highlands","st_stusps":"FL","prep_score":1,"prep_level":"Very Low","pc_score":12,"hr_score":11,"dem_score":1,"se_score":18,"covid_score":38,"lat":27.3410799,"lon":-81.3423534},
		{"cartodb_id":2,"name":"Lubbock","st_stusps":"TX","prep_score":22,"prep_level":"Low","pc_score":7,"hr_score":6,"dem_score":94,"se_score":47,"covid_score":39,"lat":33.6114688,"lon":-101.8199438}
	]
</script>

<div style="z-index: 10000; position: absolute; top: 10px; left: 200px; display: flex; padding: 12px; border-radius: 12px; background: black; align-items: baseline; opacity: 0.8;">
	<div style="color: white; font-family: sans-serif">Map Class API demo: </div>
	<button style="padding: 8px; margin: 8px; border-radius: 4px;" onclick="map.selectCountyInCountyPrepLayer(sampleCounties[0])">Select county Highlands, FL</button>
	<button style="padding: 8px; margin: 8px; border-radius: 4px;" onclick="map.selectCountyInCountyPrepLayer(sampleCounties[1])">Select county Lubbock, TX</button>
	<button style="padding: 8px; margin: 8px; border-radius: 4px;" onclick="map.closePopup()">Close Popup</button>
</div>

</body>
</html>
